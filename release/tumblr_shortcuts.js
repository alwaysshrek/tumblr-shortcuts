(function(){var f,g,h,i,j,k,c,d=function(b,a){return function(){return b.apply(a,arguments)}};f=function(b){return document.getElementById(b)};j=function(b,a){var l;return(l=b.className)!=null?l.match(RegExp("\\b"+a+"\\b","im")):void 0};k=function(b,a){return j(b,a)?b.className=b.className.replace(a,""):b.className+=a};h=function(){function b(){this._interceptor=d(this._interceptor,this);var a;this._mapping={};this._lookup={enter:13,escape:27,up:38,left:37,right:39,down:40};for(a=1;a<=12;a++)this._lookup["f"+
a]=111+a;window.addEventListener("keydown",this._interceptor)}b.prototype.add=function(a,b){var e,c,d;if(b==null){d=[];for(c in a)e=a[c],d.push(this._add(c,e));return d}else return this._add(a,b)};b.prototype._add=function(a,b){var e,c,d;c=a.match(/((ctrl|alt|meta|shift)\+)?([a-z0-9]+)(:input)?/i);d=c[2];e=c[3];c=c[4];e=e.length===1?e.toUpperCase().charCodeAt(0):this._lookup[e];d=this._serialize_mod({altKey:d==="alt",ctrlKey:d==="ctrl",shiftKey:d==="shift",metaKey:d==="meta"});this._mapping[e]==null&&
(this._mapping[e]={});return this._mapping[e][d]={input:c!=null,event:b}};b.prototype._is_input=function(a){return a instanceof HTMLTextAreaElement||a instanceof HTMLInputElement};b.prototype._serialize_mod=function(a){return 1*a.altKey+2*a.ctrlKey+4*a.metaKey+8*a.shiftKey};b.prototype._interceptor=function(a){var b,e;if(a==null)a=window.event;e=this._mapping[a.charCode||a.keyCode];b=this._serialize_mod(a);if(e!=null&&e[b]!=null&&this._is_input(a.target)===e[b].input)return e[b].event(a)};return b}();
i=function(){function b(){this.curPost=d(this.curPost,this);this.prevPost=d(this.prevPost,this);this.nextPost=d(this.nextPost,this);this.prevPage=d(this.prevPage,this);this.nextPage=d(this.nextPage,this);this.changeBlog=d(this.changeBlog,this);this.queuePost=d(this.queuePost,this);this.cancelReblog=d(this.cancelReblog,this);this.confirmReblog=d(this.confirmReblog,this);this.sendReply=d(this.sendReply,this);this.view=d(this.view,this);this.page=d(this.page,this);this.reblog=d(this.reblog,this)}b.prototype._clickElement=
function(a,b){var e;b==null&&(b=!1);if(a!=null)return e=document.createEvent("MouseEvents"),e.initMouseEvent("click",!0,!0,window,0,0,0,0,0,b,!1,!1,!1,0,null),a.dispatchEvent(e)};b.prototype._pressKey=function(a){var b;b=document.createEvent("KeyboardEvent");b.initKeyboardEvent("keydown",!0,!0,null,a.charCodeAt(0),!1,!1,!1,0);return document.dispatchEvent(b)};b.prototype._changeSelected=function(a,b){var e;if(a!=null)return a.selectedIndex=b,e=document.createEvent("Event"),e.initEvent("change",!0,
!1),a.dispatchEvent(e)};b.prototype._getReblogLink=function(a){var b,e,c,d;b=f(a).getElementsByClassName("post_controls")[0].getElementsByTagName("a");e=0;for(c=b.length;e<c;e++)if(a=b[e],(d=a.href)!=null&&d.match("reblog"))return a};b.prototype.reblog=function(a,b){b==null&&(b=!1);return this._clickElement(this._getReblogLink(a),b)};b.prototype.page=function(a){a=this._getReblogLink(a);a=decodeURIComponent(a.href.match(/redirect_to=.*/)[0].substring(12));return window.location.replace(a)};b.prototype.view=
function(a){a="permalink_"+a.substring(5);return this._clickElement(f(a),!0)};b.prototype.sendReply=function(a){a="reply_button_"+a.id.substring(12);return this._clickElement(f(a))};b.prototype.confirmReblog=function(){return this._clickElement(f("save_button"))};b.prototype.cancelReblog=function(){return this._clickElement(f("cancel_button"))};b.prototype.queuePost=function(){return this._changeSelected(f("post_state"),1)};b.prototype.changeBlog=function(){var a;a=f("channel_id");return this._changeSelected(a,
a.selectedIndex<a.length-1?a.selectedIndex+1:0)};b.prototype.nextPage=function(){return this._clickElement(f("next_page_link"))};b.prototype.prevPage=function(){return this._clickElement(f("previous_page_link"))};b.prototype.nextPost=function(){return this._pressKey("J")};b.prototype.prevPost=function(){return this._pressKey("K")};b.prototype.curPost=function(){var a,b,e,c,d;b=document.body.scrollTop+7;e=f("posts").childNodes;c=0;for(d=e.length;c<d;c++)if(a=e[c],j(a,"post")&&b>=a.offsetTop&&b<=a.offsetTop+
a.offsetHeight)return a.id};return b}();g=function(){function b(){this.toggle=d(this.toggle,this);this.injectHTML=d(this.injectHTML,this);this.injectStyles=d(this.injectStyles,this);var a=this;this.injected=!1;window.addEventListener("load",function(){return a.inject()})}b.prototype.inject=function(){if(!this.injected)return this.injected=!0,this.injectStyles(),this.injectHTML()};b.prototype.injectStyles=function(){var a,b;b=document.createElement("style");b.setAttribute("type","text/css");a=document.createTextNode("#tumblr_shortcuts_help {\n    color: white;\n    cursor: pointer;\n}\n#tumblr_shortcuts_help.hidden {\n    display: none;\n}\n#tumblr_shortcuts_curtain {\n    position: fixed;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    background: black;\n    opacity: 0.3;\n    z-index: 10000;\n}\n#tumblr_shortcuts_popup {\n    position: fixed;\n    width: 400px;\n    top: 150px;\n    left: 50%;\n    margin-left: -200px;\n    background: black;\n    opacity: 0.8;\n    padding: 30px;\n    border-radius: 10px;\n    z-index: 20000;\n}\n#tumblr_shortcuts_popup h1, #tumblr_shortcuts_popup h2, #tumblr_shortcuts_popup p {\n    color: white;\n}\n#tumblr_shortcuts_popup table tr td:last {\n    padding-left: 10px;\n}");
b.appendChild(a);return document.head.appendChild(b)};b.prototype.injectHTML=function(){var a;a=document.createElement("div");a.setAttribute("id","tumblr_shortcuts_help");a.setAttribute("class","hidden");a.innerHTML='<div id="tumblr_shortcuts_curtain"></div>\n<div id="tumblr_shortcuts_popup">\n    <h1>Shortcuts</h1>\n\n    <h2>Dashboard</h2>\n    <p>\n        <table>\n        <tbody>\n            <tr>\n                <td>j</td><td>next post</td>\n            </tr>\n            <tr>\n                <td>k</td><td>previous post</td>\n            </tr>\n            <tr>\n                <td>l</td><td>like</td>\n            </tr>\n            <tr>\n                <td>r</td><td>reblog</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;r</td><td>reblog in a new tab</td>\n            </tr>\n            <tr>\n                <td>v</td><td>view post in a new tab (without loosing focus)</td>\n            </tr>\n            <tr>\n                <td>p</td><td>open current page</td>\n            </tr>\n            <tr>\n                <td>ctrl&nbsp;+&nbsp;enter</td><td>(while writing a reply) send reply</td>\n            </tr>\n        </tbody>\n        </table>\n    </p>\n\n    <h2>Reblog page</h2>\n    <p>\n        <table>\n        <tbody>\n            <tr>\n                <td>ctrl&nbsp;+&nbsp;enter</td><td>confirm reblogging</td>\n            </tr>\n            <tr>\n                <td>esc</td><td>cancel</td>\n            </tr>\n            <tr>\n                <td>q</td><td>select "add to queue" instead of "publish now"</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;q</td><td>place post in the queue</td>\n            </tr>\n            <tr>\n                <td>b</td><td>switch blogs</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;b</td><td>switch blog & publish</td>\n            </tr>\n        </tbody>\n        </table>\n    </p>\n\n</div>';
a.addEventListener("click",this.toggle);return document.body.appendChild(a)};b.prototype.toggle=function(){this.inject();return k(f("tumblr_shortcuts_help"),"hidden")};return b}();c=new i;h=new h;g=new g;h.add({f1:g.toggle});g=window.location.href.toLowerCase();g.indexOf("/dashboard")!==-1?h.add({r:function(){return c.reblog(i.curPost())},v:function(){return c.view(i.curPost())},p:function(){return c.page(i.curPost())},"alt+r":function(){return c.reblog(i.curPost(),!0)},"ctrl+enter:input":function(b){return c.sendReply(b.target)},
"alt+right":c.nextPage,"alt+left":c.prevPage,"alt+up":c.prevPost,"alt+down":c.nextPost}):g.indexOf("/reblog/")!==-1&&h.add({b:c.changeBlog,"alt+b":function(){c.changeBlog();return c.confirmReblog()},q:c.queuePost,"alt+q":function(){c.queuePost();return c.confirmReblog()},escape:c.cancelReblog,"ctrl+enter":c.confirmReblog})}).call(this);
