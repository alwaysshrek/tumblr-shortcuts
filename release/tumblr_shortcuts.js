(function(){var g,h,i,k,j,l,c,d=function(b,a){return function(){return b.apply(a,arguments)}};g=function(b){return document.getElementById(b)};j=function(b,a){var m;return null!=(m=b.className)?m.match(RegExp("\\b"+a+"\\b","im")):void 0};l=function(b,a){return j(b,a)?b.className=b.className.replace(a,""):b.className+=a};i=function(){function b(){this._interceptor=d(this._interceptor,this);var a;this._mapping={};this._lookup={enter:13,escape:27,up:38,left:37,right:39,down:40};for(a=1;12>=a;a++)this._lookup["f"+
a]=111+a;window.addEventListener("keydown",this._interceptor)}b.prototype.add=function(a,b){var e,c,f;if(null==b){f=[];for(c in a)e=a[c],f.push(this._add(c,e));return f}return this._add(a,b)};b.prototype._add=function(a,b){var e,c,f;c=a.match(/((ctrl|alt|meta|shift)\+)?([a-z0-9]+)(:input)?/i);f=c[2];e=c[3];c=c[4];e=1===e.length?e.toUpperCase().charCodeAt(0):this._lookup[e];f=this._serialize_mod({altKey:"alt"===f,ctrlKey:"ctrl"===f,shiftKey:"shift"===f,metaKey:"meta"===f});null==this._mapping[e]&&
(this._mapping[e]={});return this._mapping[e][f]={input:null!=c,event:b}};b.prototype._is_input=function(a){return a instanceof HTMLTextAreaElement||a instanceof HTMLInputElement};b.prototype._serialize_mod=function(a){return 1*a.altKey+2*a.ctrlKey+4*a.metaKey+8*a.shiftKey};b.prototype._interceptor=function(a){var b,e;null==a&&(a=window.event);e=this._mapping[a.charCode||a.keyCode];b=this._serialize_mod(a);if(null!=e&&null!=e[b]&&this._is_input(a.target)===e[b].input)return e[b].event(a)};return b}();
k=function(){function b(){this.curPost=d(this.curPost,this);this.prevPost=d(this.prevPost,this);this.nextPost=d(this.nextPost,this);this.prevPage=d(this.prevPage,this);this.nextPage=d(this.nextPage,this);this.changeBlog=d(this.changeBlog,this);this.queuePost=d(this.queuePost,this);this.cancelReblog=d(this.cancelReblog,this);this.confirmReblog=d(this.confirmReblog,this);this.sendReply=d(this.sendReply,this);this.view=d(this.view,this);this.page=d(this.page,this);this.reblog=d(this.reblog,this)}b.prototype._clickElement=
function(a,b,e){var c,f;null==b&&(b=!1);null==e&&(e=!1);if(null!=a)return f=!1,b&&-1!==window.navigator.appVersion.indexOf("Mac OS")&&(f=!0,b=!1),c=document.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,window,0,0,0,0,0,b,e,!1,f,0,null),a.dispatchEvent(c)};b.prototype._pressKey=function(a){var b;b=document.createEvent("KeyboardEvent");b.initKeyboardEvent("keydown",!0,!0,null,a.charCodeAt(0),!1,!1,!1,0);return document.dispatchEvent(b)};b.prototype._changeSelected=function(a,b){var c;if(null!=
a)return a.selectedIndex=b,c=document.createEvent("Event"),c.initEvent("change",!0,!1),a.dispatchEvent(c)};b.prototype._getReblogLink=function(a){var b,c,d,f;b=g(a).getElementsByClassName("post_controls")[0].getElementsByTagName("a");c=0;for(d=b.length;c<d;c++)if(a=b[c],null!=(f=a.href)&&f.match("reblog"))return a};b.prototype.reblog=function(a,b){null==b&&(b=!1);return this._clickElement(this._getReblogLink(a),!1,b)};b.prototype.page=function(a){a=this._getReblogLink(a);a=decodeURIComponent(a.href.match(/redirect_to=.*/)[0].substring(12));
return window.location.replace(a)};b.prototype.view=function(a){a="permalink_"+a.substring(5);return this._clickElement(g(a),!0)};b.prototype.sendReply=function(a){a="reply_button_"+a.id.substring(12);return this._clickElement(g(a))};b.prototype.confirmReblog=function(){return this._clickElement(g("save_button"))};b.prototype.cancelReblog=function(){return this._clickElement(g("cancel_button"))};b.prototype.queuePost=function(){return this._changeSelected(g("post_state"),1)};b.prototype.changeBlog=
function(){var a;a=g("channel_id");return this._changeSelected(a,a.selectedIndex<a.length-1?a.selectedIndex+1:0)};b.prototype.nextPage=function(){return this._clickElement(g("next_page_link"))};b.prototype.prevPage=function(){return this._clickElement(g("previous_page_link"))};b.prototype.nextPost=function(){return this._pressKey("J")};b.prototype.prevPost=function(){return this._pressKey("K")};b.prototype.curPost=function(){var a,b,c,d,f;b=document.body.scrollTop+7;c=g("posts").childNodes;d=0;for(f=
c.length;d<f;d++)if(a=c[d],j(a,"post")&&b>=a.offsetTop&&b<=a.offsetTop+a.offsetHeight)return a.id};return b}();h=function(){function b(){this._injectButton=d(this._injectButton,this);this._injectPopup=d(this._injectPopup,this);this.toggle=d(this.toggle,this);var a=this;this.injected=!1;window.addEventListener("DOMContentLoaded",function(){return a.inject()})}b.prototype.inject=function(){if(!this.injected)return this.injected=!0,this._injectPopup(),this._injectButton()};b.prototype.toggle=function(a){null!=
a&&a.preventDefault();this.inject();return l(g("tumblr_shortcuts_help"),"hidden")};b.prototype._injectPopup=function(){var a;a=document.createElement("div");a.setAttribute("id","tumblr_shortcuts_help");a.setAttribute("class","hidden");a.innerHTML='<div id="tumblr_shortcuts_curtain"></div>\n<div id="tumblr_shortcuts_popup">\n    <h1>Shortcuts</h1>\n\n    <h2>Dashboard</h2>\n    <p>\n        <table>\n        <tbody>\n            <tr>\n                <td>j</td><td>next post</td>\n            </tr>\n            <tr>\n                <td>k</td><td>previous post</td>\n            </tr>\n            <tr>\n                <td>l</td><td>like</td>\n            </tr>\n            <tr>\n                <td>r</td><td>open reblog page</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;r</td><td>reblog without opening a page(ajax)</td>\n            </tr>\n            <tr>\n                <td>v</td><td>view post in a new tab (without loosing afocus)</td>\n            </tr>\n            <tr>\n                <td>p</td><td>open current page</td>\n            </tr>\n            <tr>\n                <td>ctrl&nbsp;+&nbsp;enter</td><td>(while writing a reply) send reply</td>\n            </tr>\n        </tbody>\n        </table>\n    </p>\n\n    <h2>Reblog page</h2>\n    <p>\n        <table>\n        <tbody>\n            <tr>\n                <td>ctrl&nbsp;+&nbsp;enter</td><td>confirm reblogging</td>\n            </tr>\n            <tr>\n                <td>esc</td><td>cancel</td>\n            </tr>\n            <tr>\n                <td>q</td><td>select "add to queue" instead of "publish now"</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;q</td><td>place post in the queue</td>\n            </tr>\n            <tr>\n                <td>b</td><td>switch blogs</td>\n            </tr>\n            <tr>\n                <td>alt&nbsp;+&nbsp;b</td><td>switch blog & publish</td>\n            </tr>\n        </tbody>\n        </table>\n    </p>\n\n</div>';
a.addEventListener("click",this.toggle);return document.body.appendChild(a)};b.prototype._injectButton=function(){var a,b;b=document.createElement("div");b.setAttribute("class","tab iconic");a=document.createElement("a");a.setAttribute("id","tumblr_shortcuts_button");a.setAttribute("title","Shortcuts");a.appendChild(document.createTextNode("Shortcuts"));a.addEventListener("click",this.toggle);b.appendChild(a);return g("user_tools").insertBefore(b,g("preferences_button"))};return b}();c=new k;i=new i;
h=new h;i.add({f1:h.toggle});h=window.location.href.toLowerCase();-1!==h.indexOf("/dashboard")?i.add({r:function(){return c.reblog(c.curPost())},v:function(){return c.view(c.curPost())},p:function(){return c.page(c.curPost())},"alt+r":function(){return c.reblog(c.curPost(),!0)},"ctrl+enter:input":function(b){return c.sendReply(b.target)},"alt+right":c.nextPage,"alt+left":c.prevPage,"alt+up":c.prevPost,"alt+down":c.nextPost}):-1!==h.indexOf("/reblog/")&&i.add({b:c.changeBlog,"alt+b":function(){c.changeBlog();
return c.confirmReblog()},q:c.queuePost,"alt+q":function(){c.queuePost();return c.confirmReblog()},escape:c.cancelReblog,"ctrl+enter":c.confirmReblog})}).call(this);
